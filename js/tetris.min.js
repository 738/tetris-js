var to,wid=10,hei=18,vel=500,scr=0,nowps=[],st=0,rs=0,xM=0,yM=0,oa=new Array;for(i=0;i<7;i++)oa[i]="on"+(i+1);shape="00,01,02,03|00,10,20,30$01,10,11,12|00,10,11,20|00,01,02,11|01,10,11,21$00,01,10,11$00,01,11,12|01,10,11,20$01,02,10,11|00,10,11,21$00,01,02,12|01,11,20,21|00,10,11,12|00,01,10,20$00,01,02,10|00,01,11,21|02,10,11,12|00,10,20,21",shapeY="0,0,0,0|3$1,1,1|2,1|0,1,0|1,2$1,1$0,1,1|2,1$1,1,0|1,2$0,0,1|2,2|1,1,1|2,0$1,0,0|0,2|1,1,1|2,2";for(var row=new Array(hei),cell=new Array(hei),TT=document.getElementById("TT"),i=0;i<hei;i++)cell[i]=new Array(wid);for(i=0;i<hei;i++){row[i]=TT.insertRow(-1);for(var j=0;j<wid;j++)cell[i][j]=row[i].insertCell(j),cell[i][j].setAttribute("id","td"+i+"_"+j)}var t,ta=new Array(hei);for(i=0;i<hei;i++)ta[i]=new Array(wid);for(i=0;i<hei;i++)for(j=0;j<wid;j++)ta[i][j]=document.getElementById("td"+i+"_"+j);function mkBlk(){ps=[0,Math.floor(wid/2-1)],nowps=ps,st=Math.floor(7*Math.random()),rs=0,yM=parseInt(getMx(st,rs)[0]),xM=parseInt(getMx(st,rs)[1]),drw(nowps,st,rs),to=setTimeout(function(){dwn()},vel)}function rtBlk(){var s=0;for(ln=shp(st,rs).length,st_ln=shape.split("$")[st].split("|").length,tm_rs=rs,tm_rs<st_ln-1?tm_rs++:tm_rs==st_ln-1&&(tm_rs=0),i=0;i<ln;i++)if(yS=shp(st,tm_rs)[i].substring(0,1),xS=shp(st,tm_rs)[i].substring(1,2),y=nowps[0]+parseInt(yS,10),x=nowps[1]+parseInt(xS,10),ta[y][x].className==oa[0]||ta[y][x].className==oa[1]||ta[y][x].className==oa[2]||ta[y][x].className==oa[3]||ta[y][x].className==oa[4]||ta[y][x].className==oa[5]||ta[y][x].className==oa[6]||x>wid-1||y>hei-1){s=1;break}0==s&&(ers(nowps,st,rs),rs<st_ln-1?rs++:rs==st_ln-1&&(rs=0),drw(nowps,st,rs),yM=parseInt(getMx(st,rs)[0]),xM=parseInt(getMx(st,rs)[1]))}function RBlk(){if(nowps[1]+xM<wid-1){var s=0;for(ln=shp(st,rs).length,i=0;i<ln;i++)if(yS=shp(st,rs)[i].substring(0,1),xS=shp(st,rs)[i].substring(1,2),y=nowps[0]+parseInt(yS,10),x=nowps[1]+parseInt(xS,10),x+=1,ta[y][x].className==oa[0]||ta[y][x].className==oa[1]||ta[y][x].className==oa[2]||ta[y][x].className==oa[3]||ta[y][x].className==oa[4]||ta[y][x].className==oa[5]||ta[y][x].className==oa[6]){s=1;break}0==s&&(ers(nowps,st,rs),nowps[1]+=1,drw(nowps,st,rs))}}function LBlk(){if(nowps[1]>0){var s=0;for(ln=shp(st,rs).length,i=0;i<ln;i++)if(yS=shp(st,rs)[i].substring(0,1),xS=shp(st,rs)[i].substring(1,2),y=nowps[0]+parseInt(yS,10),x=nowps[1]+parseInt(xS,10),x-=1,ta[y][x].className==oa[0]||ta[y][x].className==oa[1]||ta[y][x].className==oa[2]||ta[y][x].className==oa[3]||ta[y][x].className==oa[4]||ta[y][x].className==oa[5]||ta[y][x].className==oa[6]){s=1;break}0==s&&(ers(nowps,st,rs),nowps[1]-=1,drw(nowps,st,rs))}}function dwn(){if(t=setTimeout(function(){dwn()},vel),nowps[0]+yM<=hei-1){var s=0;for(ln=shp(st,rs).length,i=0;i<ln;i++){if(yS=shp(st,rs)[i].substring(0,1),xS=shp(st,rs)[i].substring(1,2),y=nowps[0]+parseInt(yS,10),x=nowps[1]+parseInt(xS,10),y+=1,nowps[0]+yM==hei-1){s=1,setOn(nowps,st,rs),clearTimeout(t),clearTimeout(to),chkf(),mkBlk();break}if(ta[y][x].className==oa[0]||ta[y][x].className==oa[1]||ta[y][x].className==oa[2]||ta[y][x].className==oa[3]||ta[y][x].className==oa[4]||ta[y][x].className==oa[5]||ta[y][x].className==oa[6]){s=1,setOn(nowps,st,rs),clearTimeout(t),clearTimeout(to),chkf(),mkBlk();break}}0==s&&(ers(nowps,st,rs),nowps[0]++,drw(nowps,st,rs))}for(i=0;i<wid;i++)if(ta[0][i].className==oa[0]||ta[0][i].className==oa[1]||ta[0][i].className==oa[2]||ta[0][i].className==oa[3]||ta[0][i].className==oa[4]||ta[0][i].className==oa[5]||ta[0][i].className==oa[6]){clearTimeout(to),alert("score: "+scr);break}}function dwnQk(){A=hei-1;var s=0;for(ln=shapeY.split("$")[st].split("|")[rs].split(",").length,i=0;i<ln;i++)for(yS=shapeY.split("$")[st].split("|")[rs].split(",")[i],y=nowps[0]+parseInt(yS,10),x=nowps[1]+i,j=0;j<hei-nowps[0]-yM;j++){if(y+=1,nowps[0]+yM+j==hei-1){s=1,j<A&&(A=j);break}if(ta[y][x].className==oa[0]||ta[y][x].className==oa[1]||ta[y][x].className==oa[2]||ta[y][x].className==oa[3]||ta[y][x].className==oa[4]||ta[y][x].className==oa[5]||ta[y][x].className==oa[6]){s=1,j<A&&(A=j);break}}1==s&&(ers(nowps,st,rs),nowps[0]+=A,drw(nowps,st,rs))}function drw(s,a,t){for(na=new Array,i=0;i<7;i++)na[i]="now"+(i+1);for(ln=shp(a,t).length,i=0;i<ln;i++)yS=shp(a,t)[i].substring(0,1),xS=shp(a,t)[i].substring(1,2),y=s[0]+parseInt(yS,10),x=s[1]+parseInt(xS,10),ta[y][x].className=na[a]}function ers(s,a,t){for(ln=shp(a,t).length,i=0;i<ln;i++)yS=shp(a,t)[i].substring(0,1),xS=shp(a,t)[i].substring(1,2),y=s[0]+parseInt(yS,10),x=s[1]+parseInt(xS,10),ta[y][x].className=""}function setOn(s,a,t){for(ln=shp(a,t).length,i=0;i<ln;i++)yS=shp(a,t)[i].substring(0,1),xS=shp(a,t)[i].substring(1,2),y=s[0]+parseInt(yS,10),x=s[1]+parseInt(xS,10),ta[y][x].className=oa[a]}function getMx(){for(yx=[],ar=[],mx=0,ln=shp(st,rs).length,i=0;i<ln;i++)ar[i]=shp(st,rs)[i].substring(0,1);for(i=0;i<ln;i++)mx=max(ar);for(yx[0]=mx,mx=0,i=0;i<ln;i++)ar[i]=shp(st,rs)[i].substring(1,2);for(i=0;i<ln;i++)mx=max(ar);return yx[1]=mx,yx}function max(s){for(M=0,i=0;i<s.length;i++)s[i]>M&&(M=s[i]);return M}function shp(s,a){return shape.split("$")[s].split("|")[a].split(",")}function chkf(){for(bn=0,i=nowps[0];i<=nowps[0]+yM;i++){for(isOn=0,j=0;j<wid;j++)ta[i][j].className!=oa[0]&&ta[i][j].className!=oa[1]&&ta[i][j].className!=oa[2]&&ta[i][j].className!=oa[3]&&ta[i][j].className!=oa[4]&&ta[i][j].className!=oa[5]&&ta[i][j].className!=oa[6]||isOn++;if(isOn==wid){for(bn++,j=0;j<wid;j++)ta[i][j].className="";for(a=i-1;a>=0;a-=1)for(b=0;b<wid;b++)for(c=0;c<7;c++)if(ta[a][b].className==oa[c]){ta[a][b].className="",ta[a+1][b].className=oa[c];break}}}1==bn?scr+=10:2==bn?scr+=50:3==bn?scr+=100:4==bn&&(scr+=200),scr<2e3?vel=500:scr<4e3?vel=450:scr<7e3?vel=400:scr<1e4?vel=350:scr<15e3?vel=300:scr<3e4?vel=250:scr<5e4?vel=200:scr<1e5&&(vel=150),document.getElementById("scr").innerHTML="score: "+scr}mkBlk(),document.onkeydown=function(s){37==s.keyCode?LBlk():39==s.keyCode?RBlk():40==s.keyCode?dwnQk():38==s.keyCode&&rtBlk()},document.onkeydown=function(){37==event.keyCode?LBlk():39==event.keyCode?RBlk():40==event.keyCode?dwnQk():38==event.keyCode&&rtBlk()};